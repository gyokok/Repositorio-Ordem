<section class="tab flexcol {{tab.cssClass}}" data-tab="abilities" data-group="primary">
{{!-- Botão de Controle --}}
<div style="text-align: right; margin-bottom: {{#if mostrarRecursos}}2px{{else}}10px{{/if}}; padding-right: 5px;">
    <a data-action="toggleResources" title="Gerenciar Recursos" style="color: {{#if mostrarRecursos}}#d4af37{{else}}#555{{/if}}; text-decoration: none; font-size: 12px;">
        <i class="fas fa-boxes"></i> {{#if mostrarRecursos}}Ocultar Recursos{{else}}Gerir Recursos{{/if}}
    </a>
</div>

{{!-- Área de Recursos (Tudo dentro deste IF some quando desligado) --}}
{{#if mostrarRecursos}}

    {{!-- Gerenciador de Recursos --}}
    <div class="ritual-dt" style="margin-bottom: 2px; padding: 4px; display: flex; justify-content: space-between; gap: 4px; align-items: flex-end;">
        
        {{!-- Recurso 01 --}}
        <div class="resource-item" style="display: flex; flex-direction: column; align-items: center; gap: 0; flex: 1;">
            <input type="text" name="system.resources.res1.label" value="{{system.resources.res1.label}}" placeholder="Recurso 1" style="border: none; background: transparent; text-align: center; font-weight: bold; font-family: 'Optima Nova LT PRO', 'Roboto', sans-serif; width: 100%; min-width: 0; color: inherit; margin: 0; padding: 0; height: auto;"/>
            <div style="display: flex; align-items: center; gap: 2px; justify-content: center;">
                <input type="number" name="system.resources.res1.value" value="{{system.resources.res1.value}}" placeholder="0" style="width: 30px; text-align: center; border: none; border-bottom: 1px solid #888; background: transparent; height: 20px; color: inherit; padding: 0;"/>
                <span style="font-weight: bold;">/</span>
                <input type="number" name="system.resources.res1.max" value="{{system.resources.res1.max}}" placeholder="0" style="width: 30px; text-align: center; border: none; border-bottom: 1px solid #888; background: transparent; height: 20px; color: inherit; padding: 0;"/>
            </div>
        </div>

        {{!-- Recurso 02 --}}
        <div class="resource-item" style="display: flex; flex-direction: column; align-items: center; gap: 0; flex: 1;">
            <input type="text" name="system.resources.res2.label" value="{{system.resources.res2.label}}" placeholder="Recurso 2" style="border: none; background: transparent; text-align: center; font-weight: bold; font-family: 'Optima Nova LT PRO', 'Roboto', sans-serif; width: 100%; min-width: 0; color: inherit; margin: 0; padding: 0; height: auto;"/>
            <div style="display: flex; align-items: center; gap: 2px; justify-content: center;">
                <input type="number" name="system.resources.res2.value" value="{{system.resources.res2.value}}" placeholder="0" style="width: 30px; text-align: center; border: none; border-bottom: 1px solid #888; background: transparent; height: 20px; color: inherit; padding: 0;"/>
                <span style="font-weight: bold;">/</span>
                <input type="number" name="system.resources.res2.max" value="{{system.resources.res2.max}}" placeholder="0" style="width: 30px; text-align: center; border: none; border-bottom: 1px solid #888; background: transparent; height: 20px; color: inherit; padding: 0;"/>
            </div>
        </div>

        {{!-- Recurso 03 --}}
        <div class="resource-item" style="display: flex; flex-direction: column; align-items: center; gap: 0; flex: 1;">
            <input type="text" name="system.resources.res3.label" value="{{system.resources.res3.label}}" placeholder="Recurso 3" style="border: none; background: transparent; text-align: center; font-weight: bold; font-family: 'Optima Nova LT PRO', 'Roboto', sans-serif; width: 100%; min-width: 0; color: inherit; margin: 0; padding: 0; height: auto;"/>
            <div style="display: flex; align-items: center; gap: 2px; justify-content: center;">
                <input type="number" name="system.resources.res3.value" value="{{system.resources.res3.value}}" placeholder="0" style="width: 30px; text-align: center; border: none; border-bottom: 1px solid #888; background: transparent; height: 20px; color: inherit; padding: 0;"/>
                <span style="font-weight: bold;">/</span>
                <input type="number" name="system.resources.res3.max" value="{{system.resources.res3.max}}" placeholder="0" style="width: 30px; text-align: center; border: none; border-bottom: 1px solid #888; background: transparent; height: 20px; color: inherit; padding: 0;"/>
            </div>
        </div>
    </div>
{{/if}}
    <hr class="divider"> </div>
	<div class="abilities-details">
		<ol class="items-list main-items">
			{{#each abilities.valid as |abilities type|}}
			<li class="item flexrow items-header">
				<div class="item-name">
					{{#ifEquals type 1}} {{localize "op.powerTypeChoices.origin"}} 	{{/ifEquals}}
					{{#ifEquals type 2}} {{localize "op.abilitiesAbv.class"}} 	{{/ifEquals}}
					{{#ifEquals type 3}} {{localize "op.abilitiesAbv.path"}}	{{/ifEquals}}
					{{#ifEquals type 4}} {{localize "op.abilitiesAbv.paranormal"}} 	{{/ifEquals}}
					{{#ifEquals type 5}} {{localize "op.abilitiesAbv.ability"}} 	{{/ifEquals}}
				</div>
                {{!-- COLUNAS ATUALIZADAS --}}
				<div class="item-formula" style="flex: 0 0 120px;">{{localize "op.type"}}</div>
				<div class="item-formula" style="flex: 0 0 80px;">{{localize "op.cost"}}</div>
				<div class="item-formula" style="flex: 0 0 100px;">{{localize "op.execution"}}</div>
				
                <div class="item-controls">
					{{#if @root.editable}}
						<a class="item-control item-create"
						data-action="createDoc"
						title="Create item"
						data-document-class="Item"
						data-type="ability"
						data-id="{{type}}"
						data-system.ability-Type="{{abilityTypeHelper type}}">
							<i class="fas fa-plus"></i>
						</a>
					{{/if}}
				</div>
			</li>
            
			{{#each abilities as |item id|}}
			<li class="item flexrow draggable" data-document-class="Item" data-item-id="{{item._id}}">
				<div class="item-name">
					<div class="item-image">
						<a class="rollable" data-roll-type="item" data-action="onRoll">
							<img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/>
						</a>
					</div>
					<h4>{{item.name}}</h4>
				</div>
                
                {{!-- TIPO --}}
				<div class="item-formula item-prop" style="flex: 0 0 120px; font-size: 11px;">
					{{#if item.system.abilityType}}
					{{localize (concat "op.powerTypeChoices." item.system.abilityType)}}
					{{else}} — {{/if}}
				</div>

                {{!-- CUSTO --}}
				<div class="item-formula item-prop" style="flex: 0 0 80px; font-size: 11px;">
                    {{item.displayCost}}
                </div>

                {{!-- EXECUÇÃO --}}
				<div class="item-formula item-prop" style="flex: 0 0 100px; font-size: 11px;">
                    {{item.activationLabel}}
                </div>

				<div class="item-controls">
					<a class="item-control item-edit" data-action="viewDoc" title="Edit Item"><i class="fas fa-edit"></i></a>
					<a class="item-control" data-action="deleteDoc" title="Delete Item"><i class="fas fa-trash"></i></a>
				</div>
			</li>
			{{/each}} 
            {{/each}}
		</ol>

        {{!-- COMPLICAÇÕES E OUTROS --}}
		{{#if abilities.invalid }}
		<section class="invalid">
			<div class="item-alert">Outros Itens</div>
			<ol class="items-list">
				{{#each abilities.invalid as |item id|}}
				<li class="item flexrow draggable" data-document-class="Item" data-item-id="{{item._id}}">
					<div class="item-name flexrow">
						<div class="item-image">
							<a class="rollable" data-roll-type="item" data-action="onRoll">
								<img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/>
							</a>
						</div>
						<h4>{{item.name}}</h4>
					</div>
                    <div class="item-formula item-prop">{{item.system.cost}}</div>
                    <div class="item-formula item-prop">
                        {{#if item.system.activation}}
                            {{localize (concat "op.executionChoices." item.system.activation)}}
                        {{/if}}
                    </div>
					<div class="item-controls">
						<a class="item-control item-edit" data-action="viewDoc" title="Edit Item"><i class="fas fa-edit"></i></a>
						<a class="item-control" data-action="deleteDoc" title="Delete Item"><i class="fas fa-trash"></i></a>
					</div>
				</li>
				{{/each}}
			</ol>
		</section>
		{{/if}}
	</div>
</section>