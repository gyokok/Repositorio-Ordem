<section class="tab flexcol {{tab.cssClass}}" data-tab="rituals" data-group="primary">
    <div class="rituals-details">
    <ol class="items-list">
        
        {{!-- Cabeçalho da DT --}}
        <div class="ritual-dt">
            <p>{{localize "op.ritualdt"}} <span>{{system.ritual.DT}}</span></p>
        </div>

        {{!-- Loop dos Círculos --}}
        {{#each rituals.valid as |rituals circle|}}
        <li class="item flexrow items-header">
            {{#ifEquals circle 5}}
                <div class="item-name"></div>
            {{else}}
                <div class="item-name">
                    {{circle}}º {{localize "op.circle"}} - 
                    {{#ifEquals circle 1}}1 PE{{/ifEquals}}
                    {{#ifEquals circle 2}}3 PE{{/ifEquals}}
                    {{#ifEquals circle 3}}6 PE{{/ifEquals}}
                    {{#ifEquals circle 4}}10 PE{{/ifEquals}}
                </div>
            {{/ifEquals}}
            
            <div class="item-space">{{localize "op.range"}}</div>
            <div class="item-space">{{localize "op.target"}}</div>
            <div class="item-space">{{localize "op.duration"}}</div>
            <div class="item-space">{{localize "op.resistance"}}</div>
            
            <div class="item-controls">
                {{#if @root.editable}}
                    <a class="item-control item-create"
                    title="Criar ritual de {{circle}}º círculo"
                    data-action="createDoc" 
                    data-document-class='Item'
                    data-type="ritual" 
                    data-system.circle="{{circle}}">
                        <i class="fas fa-plus"></i>
                    </a>
                {{/if}}
            </div>
        </li>

        {{!-- Loop dos Rituais --}}
        {{#each rituals as |item id|}}
        
        {{!-- Item Container: 'flexcol' permite que a descrição fique embaixo --}}
        <li class="item flexcol draggable" data-document-class="Item" data-item-id="{{item._id}}">
            
            {{!-- Linha de Informações (Sempre visível) --}}
            <div class="flexrow" style="width: 100%; align-items: center;">
                
                <div class="item-name flexrow">
                    <div class="item-image slide">
                        {{!-- A classe 'item-toggle' ativa o script de abrir a descrição --}}
                        {{!-- O 'rollable' continua funcionando independente --}}
                        <div class="item-toggle" style="cursor: pointer; display: inline-block;">
                             <img src="{{item.img}}" title="{{item.name}}" width="24" height="24" />
                        </div>
                        <a class="rollable" data-roll-type="item" data-action="onRoll" style="margin-left: 5px;">
                            <i class="fa-solid fa-dice-d20"></i>
                        </a>
                    </div>
                    
                    {{!-- Clique no nome também abre a descrição --}}
                    <h4 class="item-toggle" style="cursor: pointer;">{{item.name}}</h4>
                </div>
                
                <div class="item-space item-prop">
                    {{#if item.system.range}}
                    {{localize (concat "op.rangeChoices." item.system.range)}}
                    {{else}} — {{/if}}
                </div>
                
                <div class="item-space item-prop">
                    {{#if item.system.target}}
                        {{item.system.targetQtd}}
                        <span class="lowercase">{{localize (concat "op.targetChoices." item.system.target)}}</span>
                    {{else}} — {{/if}}
                </div>
                
                <div class="item-space item-prop">
                    {{#if item.system.duration}}
                    {{localize (concat "op.durationChoices." item.system.duration)}} 
                    {{else}} — {{/if}}
                </div>
                
                <div class="item-space item-prop">
                    {{#if item.system.resistance}} 
                        {{#if item.system.skillResis}}
                            {{localize (concat "op.skill." item.system.skillResis)}}
                        {{/if}}
                        {{localize (concat "op.resistanceChoices." item.system.resistance)}}
                    {{else}} — {{/if}}
                </div>
                
                <div class="item-controls">
                    <a class="item-control item-edit" data-action="viewDoc" title="Edit Item"><i class="fas fa-edit"></i></a>
                    <a class="item-control" data-action="deleteDoc" title="Delete Item"><i class="fas fa-trash"></i></a>
                </div>
            </div>

            {{!-- Descrição (Escondida por padrão via display: none) --}}
            <div class="item-description" style="display: none; width: 100%; padding: 5px 10px; border-top: 1px dashed #777; margin-top: 5px; font-size: 0.9em; text-align: left;">
                {{{item.system.description}}}
            </div>

        </li>
        {{/each}} 
        {{/each}} 

    </ol>
    </div>
</section>